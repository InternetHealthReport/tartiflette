import sys
import numpy as np
from subprocess import Popen

batchSize = 15 

# builtin4 = [5001, 5002, 5003, 5004, 5005, 5006, 5007, 5008, 5009, 5010, 5011, 5012, 5013, 5014, 5015, 5016, 5017, 5018, 5019, 5020, 5021, 5022, 5024, 5025, 5026]
# anchoring4 = [2351480, 2244316, 3315653, 1962547, 2025970, 1437284, 1026355, 3361693, 1618360, 1446417, 2096533, 1698327, 1663325, 3058685, 1879037, 3044920, 1804069, 2417650, 1898895, 1026359, 1026363, 2957509, 3203677, 1875035, 1026367, 1695913, 1637582, 2439395, 1906512, 1026371, 1722410, 3103412, 1765533, 2457234, 2386536, 1842488, 2053744, 1042417, 1664873, 2924502, 1026375, 2055768, 1596619, 1042255, 1999831, 1768115, 3321322, 1861850, 1404703, 1864028, 1835778, 1696927, 1878008, 1583040, 2004731, 1413039, 1929377, 1026379, 1026383, 1907465, 1442070, 1042403, 1639699, 1421786, 2037869, 3062261, 1401947, 1043286, 2395060, 1423186, 3295749, 1577725, 1591156, 1026387, 1849605, 1402339, 1425314, 1791291, 1026391, 2923644, 1404333, 1769991, 1789806, 1790199, 1026395, 2464285, 1664730, 2063464, 3021099, 1402317, 1769335, 1765882, 1042245, 2067456, 1026399, 1790203, 1425318, 1042421, 2016840, 1880334, 2456804, 2398519, 2020876, 3217639, 1026403, 1891018, 1733341, 1962551, 2966283, 2037106, 2020834, 1404595, 1790232, 2841887, 1402084, 1929323, 1668851, 1575997, 1666914, 1835746, 1421259, 1589862, 1748022, 2435592, 1796567, 2904335, 1789561, 1789538, 1026407, 1842448, 1596739, 1845531, 3360589, 1217480, 1217480, 1043457, 1790332, 1698331, 1803655, 1726645, 1790207, 2394115, 1672156, 1039806, 1791209, 1665836, 1675583, 1768005, 2014981, 1042425, 1801217, 2339923, 1666038, 2398550, 2852012, 1566674, 1042407, 1817189, 2017398, 1806570, 1790944, 2339853, 2021326, 1672028, 1726568, 1791306, 2856282, 1990233, 1698335, 1603550, 1612282]
# old list:
#[2067456, 1043457, 2394115, 1801217, 2398550, 1769991, 2435592, 1851699, 2020876, 2339853, 1446417, 3622418, 1698327, 5356561, 4480004, 1698331, 3678236, 2464285, 5151, 4421111, 2957509, 1875035, 2004731, 1864028, 1722410, 6937607, 4448813, 3787311, 1768115, 4439604, 1748022, 1962551, 3044920, 2841147, 6886972, 1575997, 3579455, 5332452, 2966283, 6918724, 1768005, 2016840, 3917496, 2339923, 6937686, 2055768, 1990233, 1401947, 3203677, 4438111, 1789538, 1685091, 1437284, 1817189, 1589862, 2439395, 1726568, 1004651, 1004653, 4464317, 2053744, 2063464, 3361639, 2444159, 2017398, 1789561, 4442235, 2923644, 4377618, 1929323, 3534345, 4646023, 3917962, 5332503, 6938121, 2037869, 2841887, 2457234, 2014981, 3677491, 6721690, 1854619, 1765533, 1696927, 1929377, 4587781, 3599015, 3548328, 1695913, 3564715, 2852012, 1684936, 1404595, 3103412, 1726645, 5376694, 4582071, 3596831, 3558675, 1698335, 1891018, 6892224, 1004741, 2386536, 1596739, 1596619, 4418082, 1637582, 1791291, 5460117, 1962547, 4451545, 1664730, 2244316, 1733341, 1835746, 1670371, 1402084, 3217639, 1791209, 1806570, 3295749, 3606482, 6930167, 1668851, 4426485, 6922486, 1790199, 1004795, 1577725, 1790207, 6951296, 1835778, 4580139, 1849605, 3560200, 1907465, 1999831, 3558669, 1880334, 2904335, 1842448, 1639699, 1442070, 1790232, 3834137, 3834138, 1845531,1861850, 4371230, 1404703, 3577501, 1804069, 3789094, 3603761, 3021099, 1665836, 1887537, 1026355, 4704387, 1026359, 1842488, 1026363, 3917118, 1026367, 2398519, 1026371, 1042245, 6928465, 6115164, 5339183, 1791306, 1026379, 6929228, 3360589, 1042255, 1906512, 4104529, 1423186, 1402339, 1789781, 1043286, 1026391, 6931429, 2456804, 2856282, 1026395, 1672028, 1663325, 1026399, 1666914, 1026403, 1026407, 1664873, 1591146, 1789806, 3624303, 2037106, 1591156,  1769335, 1766262, 2351480, 1860500, 1675583, 1790332, 2096533, 3624320, 2417650, 3361631, 1803655, 5001, 6943118, 5004, 5005, 5006, 1898895, 5008, 5009, 5010, 5011, 5012, 5013, 5014, 5015, 5016, 5017, 5019, 3361693, 3858501, 3560194, 1425314, 5027, 5028, 5029, 5030, 5031, 4492712, 5402540, 1404333, 1413039, 3614641, 2395060, 1618360, 1685434, 5051, 1039806, 3062261, 1583040, 3624067, 3315653, 1217480, 1421259, 1402317, 2021326, 4622289, 1566674,  2924502, 2221829, 1796567, 1421786, 1026383, 1672156, 1765882, 1603550, 1790944, 2020834, 1042403, 2024335, 1425318, 1042407, 3321322, 3058685, 1685486, 1004797, 1042417, 2025970, 3484659, 1042421, 1666038, 1790203, 1878008, 1042425, 1612282, 1879037]
# extraMsm = [1591146]
# allmsm.extend(builtin4)
# allmsm.extend(anchoring4)
# allmsm.extend(extraMsm)
blacklist=[1789781, 1818204, 2024335, 2024378, 2444159, 2444158, 5051, 5151, 1851699, 8044620, 8044621 ] # spraying msm () are too memory consuming for the forwarding anomaly analysis

allmsm = [9181186, 2394115, 1801217, 9181192, 9181198, 9183576, 6969364, 9181207, 3678236, 9181213, 7006240, 9181219, 8779815, 1722410, 9181227, 7925807, 9181233, 9183286, 9181241, 9183583, 9183294, 9181247, 3858501, 7970886, 9181259, 8044620, 8044621, 9181521, 6965327, 6928465, 9183318, 9181275, 9183324, 4438111, 9181281, 7714917, 9181287, 1726568, 9181290, 1929323, 9183340, 2037869, 9181296, 9180772, 9183347, 2017398, 9181304, 9183353, 4442235, 9181310, 9183360, 9181888, 4704387, 9181316, 9183369, 3917962, 9181324, 9183569, 9181330, 5460117, 9183384,6721690, 1765533, 1929377, 9183396, 9193049, 9181351, 1695913, 9183402, 9181357, 9183409, 9181363, 1726645, 9183415, 9181371, 9183424, 9181380, 2957509, 9183430, 9181386, 9183437, 9183443, 9181396, 7985366, 1861850, 9181410, 2439395, 3217639, 9181417, 1806570, 9183469, 9181424, 9183475, 6922486, 1790199, 9181432, 9183482, 1790203, 9181438, 1790207, 9183489, 9181444, 4587781, 9183495, 9181449, 9183500, 1880334, 2904335, 9183508, 9181461, 8843542, 1790232, 3834137, 3834138, 1845531, 8251679, 9181474, 9183523, 3789094, 9181482, 3021099, 9181489, 1851699, 9183540, 2398519, 7934264, 1026363, 9181501, 1675583, 9183553, 9181507, 8045622, 5339183, 8045623, 9183629, 4104529, 8627598, 2398550, 1026391, 9181528, 1864028, 1663325, 9181534, 1026399, 9181541, 1026407, 9181549, 9181555, 8063350, 9181561, 1790332, 7876991, 6951296, 9181573, 9183622, 9181581, 6943118, 1898895, 9181587, 9183636, 9181596, 9183645, 9181253, 9181602, 9183651, 9183302, 9181608, 9183658, 9181616, 9183665, 9181622,9183671, 1618360, 9181628, 8401342, 9181636, 9183688, 9183308, 9181642, 6930167, 9183696, 9181650, 2221829, 9183702, 1796567, 9181656, 1421786, 9183709, 9181662, 9181668, 9181265, 9183722, 9181677, 9183728, 2025970, 9181876, 3062261, 9181686, 1765882, 9181692, 9183742, 9181698, 9183748, 3295749, 1769991, 2435592, 9181705, 9183754, 3560194, 1404333, 9183760, 1446417, 9183766, 1698327, 9183514, 1698331, 9183772, 2464285, 3596831, 4418082, 1401947, 9183780, 9183786, 9181739, 4448813, 3787311, 9183792, 9181745, 1962547, 9183798, 9181751, 7862841, 2841147, 9183804, 9181759, 9183810, 6918724, 1768005, 9181771, 9183820, 9183684, 9181777, 9183826, 9181783, 9183832, 3203677, 9183333, 9181792, 1817189, 1589862, 2386536, 9181806, 9183678, 9181814, 9181820, 9181829, 7719563, 8753807, 9181841, 9183450, 9181849, 9181862, 3599015, 6976172, 9181870, 1768115, 3103412, 5376694, 4582071, 9181882, 8432316, 6892224, 1891018, 9181338, 1733341, 1835746, 4426485, 1577725, 1835778, 3560200, 1907465,2966283, 4371230, 9237283, 9237288, 4580139, 1665836, 7832378, 7990089, 6929228, 1043286, 9183716, 1672028, 3361631, 3361639, 9181671, 1766262, 2444159, 5001, 5004, 5005, 5006, 2024335, 5008, 5009, 5010, 5011, 1860500, 5013, 5014, 5015, 5016, 5017, 5019, 7816092, 3361693, 9180997, 5027, 5028, 5029, 5030, 5031, 2395060, 5051, 9180732, 9183734, 9181345, 1217480, 9181005, 1999831, 9229273, 1672156, 1612282, 7969759, 1790944, 9229281, 6931429, 2417650, 3484659, 1666038, 3058685, 2067456, 1043457, 4480004, 6937607, 2339853, 5356561, 4377618, 8778777, 8778782, 5151, 8774691, 8680488, 8045621, 1748022, 6938121, 8045624, 1575997, 9180684, 2339923, 6937686, 1875035, 9184443, 2063464, 1004651, 1004653, 2923644, 7707773, 3624067, 4646023, 8683031, 1854619, 1696927, 3548328, 3564715, 2852012, 9181725, 1698335, 7740605, 7789761, 1004741, 8568007, 1596619, 1637582, 9181731, 4451545, 9184479, 8434915, 1402084, 1791209, 6960363, 9181765, 9184495, 9184501, 1004795, 1004797, 6966526, 6952193,9184521, 3558669, 1842448, 3558675, 9181402, 2841887, 9237793, 9237803, 9183813, 3603761, 3677491, 7382327, 1842488, 9180724, 1791291, 3917118, 1596739, 1791306, 1670371, 2456804, 2856282, 9204623, 8912233, 3624303, 2037106, 5012, 3624320, 1803655, 7861646, 2096533, 9180575, 4492712, 7812525, 9180590, 9181567, 9180598, 9180604,9180610, 1684936, 9180618, 1402317, 9180624, 9180632, 9180638, 2020834, 1402339, 5332452, 9180645, 3321322, 9180652, 9180658, 9183615, 4421111, 9183547, 9180666, 9180672, 9181099, 9180678, 3534345, 2020876, 3622418, 5332503, 9180698, 1849605, 9180704, 9184804, 9180711, 9180717, 9184816, 4439604, 3044920, 8926777, 6886972, 3579455, 9180739, 2016840, 9180745, 9180751, 9193040, 9180758, 2055768, 1990233, 9181455, 9180766, 1789538, 1685091, 1437284, 9181798, 9180778, 2053744, 9180786, 1639699, 9180792, 1789561, 9180798, 7923328, 9181120, 1442070, 9180806, 9180812, 2457234, 9181711, 8711834, 3577501, 8937122, 9181467, 9180840, 9180846, 8865456, 1404595, 9180852, 3917496, 9180859, 4464317, 9180865, 9180874, 7718605, 9181133, 9180880, 9180690, 9180886, 9209465, 1664730, 2244316, 9180893, 6962912, 9180899, 9180907, 7931628, 1566674, 9180914, 1668851, 7894775, 9180920, 2004731, 9183530, 8810239, 9180928, 2014981, 9180934, 9180942, 9180948, 9180954, 1404703, 9180960, 1804069, 1887537,9180968, 9181034, 9180976, 1026355, 9180982, 9180989, 9181835, 1042245, 9181495, 3360589, 1042255, 1906512, 1423186, 9181011, 1789781, 9181017, 6115164, 1666914, 7829819, 9181028, 1664873, 1591146, 9180818, 1789806, 9181042, 7030643, 1591156, 1769335, 9181048, 7837563, 9181054, 9181060, 9181719, 9181066, 8351632, 9181075, 9181081, 9181515, 9180826, 9181087, 1425314, 9232291, 9181093, 1425318, 7708587, 5402540, 1413039, 3614641, 9181107, 9181113, 1685434, 1583040, 1026379, 3315653, 9181126, 1421259, 9180834, 2021326, 4622289, 3606482, 9181141, 2924502, 9183563, 9181147, 1603550, 9181153, 1042403, 9181159, 9181165, 1685486, 1879037, 8779761, 1042421, 9181174, 1878008, 8628217, 9181180, 9232381]

allmsm = list(set(allmsm) - set(blacklist))
batches = np.array_split(np.array(allmsm), len(allmsm)/batchSize)

proc = []

if __name__ == "__main__":
    for b in batches:

        args = [str(id) for id in b] 
        cmd = ["python2.7", "stream.py"]
        cmd.extend(args)
        proc.append(Popen(cmd))


    for p in proc:
        p.wait()
